-- Insert Euro Hackathons events
INSERT INTO hackathons (name, description, location, latitude, longitude, start_date, end_date, continent, country, city, categories, website_url, is_online) VALUES
('Build_ on SUI Hackathon #2', 'Join this exciting hackathon in √áankaya. ', '√áankaya', 39.9179, 32.8617, '2025-12-06T00:00:00+00:00', '2025-12-07T00:00:00+00:00', 'Europe', 'Turkey', '√áankaya', ARRAY['Hackathon'], 'https://lu.ma/xtbb0q4v', false),
('WEB 3 Hackathon & Ideathon', 'Join this exciting hackathon in Split. ', 'Split', 43.5081, 16.4402, '2025-12-06T00:00:00+00:00', '2025-12-07T00:00:00+00:00', 'Europe', 'Croatia', 'Split', ARRAY['Hackathon'], 'https://lu.ma/v22wzfwo', false),
('Anthropic Coding Challenge', 'Join this exciting hackathon in Z√ºrich. ', 'Z√ºrich', 47.3769, 8.5417, '2025-12-06T00:00:00+00:00', '2025-12-06T00:00:00+00:00', 'Europe', 'Switzerland', 'Z√ºrich', ARRAY['Hackathon'], 'https://lu.ma/shzve0lc', false),
('London AI hackathon', 'Join this exciting hackathon in London. ', 'London', 51.5074, -0.1278, '2025-12-09T00:00:00+00:00', '2025-12-09T00:00:00+00:00', 'Europe', 'United Kingdom', 'London', ARRAY['Hackathon'], 'https://lu.ma/w1ljwuqt', false),
('Paris AI hackathon', 'Join this exciting hackathon in Paris. ', 'Paris', 48.8566, 2.3522, '2025-12-09T00:00:00+00:00', '2025-12-09T00:00:00+00:00', 'Europe', 'France', 'Paris', ARRAY['Hackathon'], 'https://lu.ma/db3q8y7e', false),
('Vibecoding Meetup Amsterdam: How to AI üöÄüîÜüè≥Ô∏è‚Äçüåà', 'Join this exciting hackathon in Amsterdam. ', 'Amsterdam', 52.3676, 4.9041, '2025-12-10T00:00:00+00:00', '2025-12-10T00:00:00+00:00', 'Europe', 'Netherlands', 'Amsterdam', ARRAY['Hackathon'], 'https://lu.ma/1kap38hk', false),
('BLISS x InstaDeep Workshop - Foundational Models for Genomics: Decoding Genomic Sequences', 'Join this exciting hackathon in Berlin. ', 'Berlin', 52.52, 13.405, '2025-12-11T00:00:00+00:00', '2025-12-11T00:00:00+00:00', 'Europe', 'Germany', 'Berlin', ARRAY['Hackathon'], 'https://lu.ma/f3yb8zn2', false),
('AMMO AI Hackathon', 'Join this exciting hackathon in London. ', 'London', 51.5074, -0.1278, '2025-12-12T00:00:00+00:00', '2025-12-12T00:00:00+00:00', 'Europe', 'United Kingdom', 'London', ARRAY['Hackathon'], 'https://lu.ma/u5hs4tt4', false),
('The Vibe Coders - Christmas Hackathon vol.8', 'Join this exciting hackathon in Hlavn√≠ Mƒõsto Praha. ', 'Hlavn√≠ Mƒõsto Praha', 50.0755, 14.4378, '2025-12-12T00:00:00+00:00', '2025-12-12T00:00:00+00:00', 'Europe', 'Czech Republic', 'Prague', ARRAY['Hackathon'], 'https://lu.ma/wscto8jw', false),
('Epiminds Hackathon @ LONDON, UK - 13thDec ($6k cash)', 'Join this exciting hackathon in London. ', 'London', 51.5074, -0.1278, '2025-12-13T00:00:00+00:00', '2025-12-13T00:00:00+00:00', 'Europe', 'United Kingdom', 'London', ARRAY['Hackathon'], 'https://lu.ma/gkbghqvs', false),
('AI Fixathon Amsterdam - 24h Hackathon for Impact!', 'Join this exciting hackathon in Amsterdam. ', 'Amsterdam', 52.3676, 4.9041, '2025-12-13T00:00:00+00:00', '2025-12-14T00:00:00+00:00', 'Europe', 'Netherlands', 'Amsterdam', ARRAY['Hackathon'], 'https://lu.ma/fixathon', false),
('Rev Up Your Workflow: AI Agent Hackathon with Airia', 'Join this exciting hackathon in Grove. ', 'Grove', 51.6049, -1.4229, '2025-12-15T00:00:00+00:00', '2025-12-15T00:00:00+00:00', 'Europe', 'United Kingdom', 'Grove', ARRAY['Hackathon'], 'https://lu.ma/1rr8yl2m', false),
('Hackathon: Advent of Vibe-automation', 'Join this exciting hackathon in Berlin. ', 'Berlin', 52.52, 13.405, '2025-12-16T00:00:00+00:00', '2025-12-16T00:00:00+00:00', 'Europe', 'Germany', 'Berlin', ARRAY['Hackathon'], 'https://lu.ma/m7a8e77c', false),
('Tech & Sip #7: üéÅ Wrap up Vibe Coding w Lovable', 'Join this exciting hackathon in K√∏benhavn. ', 'K√∏benhavn', 55.6761, 12.5683, '2025-12-16T00:00:00+00:00', '2025-12-16T00:00:00+00:00', 'Europe', 'Denmark', 'K√∏benhavn', ARRAY['Hackathon'], 'https://lu.ma/9l273ilm', false),
('Cuneo Christmas Vibe Coding Night', 'Join this exciting hackathon in Cuneo. ', 'Cuneo', 44.3984, 7.5507, '2025-12-22T00:00:00+00:00', '2025-12-22T00:00:00+00:00', 'Europe', 'Italy', 'Cuneo', ARRAY['Hackathon'], 'https://lu.ma/0ne1443f', false),
('Hyperliquid London Hackathon', 'Join this exciting hackathon in London. ', 'London', 51.5074, -0.1278, '2026-01-16T00:00:00+00:00', '2026-01-18T00:00:00+00:00', 'Europe', 'United Kingdom', 'London', ARRAY['Hackathon'], 'https://lu.ma/vay21dno', false),
('What''s new in vibe coding? Lovable builder session', 'Join this exciting hackathon in Amsterdam. ', 'Amsterdam', 52.3676, 4.9041, '2026-01-20T00:00:00+00:00', '2026-01-20T00:00:00+00:00', 'Europe', 'Netherlands', 'Amsterdam', ARRAY['Hackathon'], 'https://lu.ma/si7l7jhd', false),
('JatHub: Join universities AI and Web3 Hackathon', 'Join this exciting hackathon in Guildford. ', 'Guildford', 51.2362, -0.5704, '2026-01-22T00:00:00+00:00', '2026-01-22T00:00:00+00:00', 'Europe', 'United Kingdom', 'Guildford', ARRAY['Hackathon'], 'https://lu.ma/4j4bqbkx', false),
('Cursor Hackathon Stuttgart', 'Join this exciting hackathon in Stuttgart. ', 'Stuttgart', 48.7758, 9.1829, '2026-01-24T00:00:00+00:00', '2026-01-24T00:00:00+00:00', 'Europe', 'Germany', 'Stuttgart', ARRAY['Hackathon'], 'https://lu.ma/sgw5glmq', false),
('Cursor Northampton Evening Hackathon', 'Join this exciting hackathon in Northampton. ', 'Northampton', 52.2405, -0.9027, '2026-02-12T00:00:00+00:00', '2026-02-12T00:00:00+00:00', 'Europe', 'United Kingdom', 'Northampton', ARRAY['Hackathon'], 'https://lu.ma/cw8l2nhn', false),
('2026 London Defence Tech Hackathon', 'Join this exciting hackathon in Camberley. Topics include: Defense.', 'Camberley', 51.337, -0.7426, '2026-05-02T00:00:00+00:00', '2026-05-03T00:00:00+00:00', 'Europe', 'United Kingdom', 'Camberley', ARRAY['Hackathon', 'Defense'], 'https://lu.ma/nn4aluwm', false)
ON CONFLICT DO NOTHING;

-- Remove duplicates keeping oldest record
DELETE FROM hackathons h1
WHERE h1.id IN (
  SELECT h2.id FROM hackathons h2
  WHERE EXISTS (
    SELECT 1 FROM hackathons h3
    WHERE h3.name = h2.name
      AND h3.location = h2.location
      AND h3.start_date = h2.start_date
      AND h3.end_date = h2.end_date
      AND h3.created_at < h2.created_at
  )
);

-- Offset stacking coordinates using spiral pattern
WITH ranked AS (
  SELECT id, latitude, longitude,
    ROW_NUMBER() OVER (PARTITION BY ROUND(latitude::numeric, 3), ROUND(longitude::numeric, 3) ORDER BY start_date) as rn
  FROM hackathons
  WHERE latitude IS NOT NULL AND longitude IS NOT NULL
)
UPDATE hackathons h
SET 
  latitude = h.latitude + (r.rn - 1) * 0.008 * COS((r.rn - 1) * 2.39996),
  longitude = h.longitude + (r.rn - 1) * 0.008 * SIN((r.rn - 1) * 2.39996)
FROM ranked r
WHERE h.id = r.id AND r.rn > 1;